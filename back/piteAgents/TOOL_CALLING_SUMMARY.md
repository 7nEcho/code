# å·¥å…·è°ƒç”¨åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ¯ ç›®æ ‡è¾¾æˆ

âœ… æˆåŠŸå®ç°äº†æœ€ç®€å•çš„å·¥å…·è°ƒç”¨åŸå‹ï¼ˆPOCï¼‰
âœ… ä½¿ç”¨ GLM-4.5 æ¨¡å‹éªŒè¯äº†å·¥å…·è°ƒç”¨æµç¨‹
âœ… å®Œå…¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œä¿æŒåŠŸèƒ½ç‹¬ç«‹æ€§

---

## ğŸ“ å®ç°çš„æ–‡ä»¶

### 1. HelloPoxToolService.java
**è·¯å¾„**: `src/main/java/pox/com/piteagents/service/HelloPoxToolService.java`

æœ€ç®€å•çš„å·¥å…·å®ç°ï¼Œè¿”å›å›ºå®šå­—ç¬¦ä¸² "hello pox"ã€‚

```java
@Service
public class HelloPoxToolService {
    public String execute() {
        return "hello pox";
    }
}
```

### 2. IZhipuService.javaï¼ˆæ–°å¢æ¥å£æ–¹æ³•ï¼‰
**è·¯å¾„**: `src/main/java/pox/com/piteagents/service/IZhipuService.java`

æ·»åŠ äº†æ–°çš„æ¥å£æ–¹æ³•ï¼š
```java
ChatResponse chatWithTools(ChatRequest request);
```

### 3. ZhipuServiceImpl.javaï¼ˆæ–°å¢å®ç°ï¼‰
**è·¯å¾„**: `src/main/java/pox/com/piteagents/service/impl/ZhipuServiceImpl.java`

**æ–°å¢æ–¹æ³•**ï¼š
- `chatWithTools()` - å®Œæ•´çš„å·¥å…·è°ƒç”¨æµç¨‹å®ç°
- `buildChatRequestWithTools()` - æ„å»ºå¸¦å·¥å…·å®šä¹‰çš„è¯·æ±‚
- `convertMessages()` - æ¶ˆæ¯åˆ—è¡¨è½¬æ¢è¾…åŠ©æ–¹æ³•

**æ ¸å¿ƒé€»è¾‘**ï¼š
1. å®šä¹‰ hello_pox å·¥å…·
2. ç¬¬ä¸€æ¬¡è°ƒç”¨ AIï¼ˆæºå¸¦å·¥å…·å®šä¹‰ï¼‰
3. æ£€æµ‹ AI æ˜¯å¦è¿”å›å·¥å…·è°ƒç”¨è¯·æ±‚
4. æ‰§è¡Œå·¥å…·å¹¶è·å–ç»“æœ
5. ç¬¬äºŒæ¬¡è°ƒç”¨ AIï¼ˆæºå¸¦å·¥å…·ç»“æœï¼‰
6. è¿”å›æœ€ç»ˆå›ç­”

### 4. ChatController.javaï¼ˆæ–°å¢ç«¯ç‚¹ï¼‰
**è·¯å¾„**: `src/main/java/pox/com/piteagents/controller/ChatController.java`

æ–°å¢ç«¯ç‚¹ï¼š`POST /api/chat/with-tools`

---

## ğŸ”‘ å…³é”®æŠ€æœ¯è¦ç‚¹

### å·¥å…·å®šä¹‰ï¼ˆä½¿ç”¨æ™ºè°± SDKï¼‰

```java
ChatTool helloPoxTool = ChatTool.builder()
    .type("function")
    .function(ChatFunction.builder()
        .name("hello_pox")
        .description("è¿”å›é—®å€™è¯­ hello poxï¼Œå½“ç”¨æˆ·æƒ³è¦è·å–é—®å€™ä¿¡æ¯æ—¶è°ƒç”¨æ­¤å·¥å…·")
        .parameters(ChatFunctionParameters.builder()
            .type("object")
            .build())
        .build())
    .build();
```

### å·¥å…·è°ƒç”¨æ£€æµ‹

```java
var toolCalls = message.getToolCalls();
if (toolCalls != null && !toolCalls.isEmpty()) {
    // æœ‰å·¥å…·è°ƒç”¨è¯·æ±‚
    String toolName = toolCalls.get(0).getFunction().getName();
    String toolCallId = toolCalls.get(0).getId();
    // æ‰§è¡Œå·¥å…·...
}
```

### å·¥å…·ç»“æœè¿”å›

```java
ChatMessage toolResultMessage = ChatMessage.builder()
    .role("tool")
    .content(toolResult)
    .toolCallId(toolCallId)
    .build();
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

| æµ‹è¯•åœºæ™¯ | ç”¨æˆ·è¾“å…¥ | AI è¡Œä¸º | ç»“æœ |
|---------|---------|---------|------|
| æ˜ç¡®è°ƒç”¨ | "è¯·è°ƒç”¨ hello_pox å·¥å…·" | âœ… è°ƒç”¨å·¥å…· | æˆåŠŸ |
| è‡ªåŠ¨åˆ¤æ–­ | "ç»™æˆ‘ä¸€ä¸ªé—®å€™è¯­" | âœ… è°ƒç”¨å·¥å…· | æˆåŠŸ |
| æ™®é€šé—®é¢˜ | "ä»€ä¹ˆæ˜¯ Javaï¼Ÿ" | âŒ ä¸è°ƒç”¨å·¥å…· | æˆåŠŸ |
| æ‰§è¡Œå‡½æ•° | "å¸®æˆ‘æ‰§è¡Œ hello_pox å‡½æ•°" | âœ… è°ƒç”¨å·¥å…· | æˆåŠŸ |

**Token æ¶ˆè€—å¯¹æ¯”**ï¼š
- æœ‰å·¥å…·è°ƒç”¨ï¼š~116-186 tokens
- æ— å·¥å…·è°ƒç”¨ï¼ˆç›´æ¥å›ç­”ï¼‰ï¼š~567 tokens

---

## ğŸ“ å­¦åˆ°çš„ç»éªŒ

### 1. æ™ºè°± SDK ç±»å
- âœ… `ChatTool` - å·¥å…·å®šä¹‰
- âœ… `ChatFunction` - å‡½æ•°å®šä¹‰ï¼ˆä¸æ˜¯ ChatToolFunctionï¼‰
- âœ… `ChatFunctionParameters` - å‚æ•°å®šä¹‰
- âœ… `type("function")` - å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸æ˜¯æšä¸¾

### 2. å·¥å…·è°ƒç”¨éœ€è¦ä¸¤æ¬¡ API è¯·æ±‚
- ç¬¬ä¸€æ¬¡ï¼šAI åˆ¤æ–­å¹¶è¿”å›å·¥å…·è°ƒç”¨è¯·æ±‚
- ç¬¬äºŒæ¬¡ï¼šåŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”

### 3. æ¶ˆæ¯è§’è‰²
- `"user"` - ç”¨æˆ·æ¶ˆæ¯
- `"assistant"` - AI æ¶ˆæ¯
- `"tool"` - å·¥å…·è¿”å›æ¶ˆæ¯ï¼ˆå…³é”®ï¼ï¼‰

---

## ğŸ“Š ä¸ç°æœ‰åŠŸèƒ½çš„å…³ç³»

```
ç°æœ‰åŠŸèƒ½ï¼ˆä¸å—å½±å“ï¼‰
â”œâ”€â”€ POST /api/chat           â†’ chat()
â”œâ”€â”€ POST /api/chat/stream    â†’ streamChat()
â””â”€â”€ GET  /api/models         â†’ getModels()

æ–°å¢åŠŸèƒ½
â””â”€â”€ POST /api/chat/with-tools â†’ chatWithTools() â­
```

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… æ–°æ–¹æ³•å®Œå…¨ç‹¬ç«‹
- âœ… ä¸ä¿®æ”¹ç°æœ‰ä»£ç 
- âœ… å¯ä»¥éšæ—¶åˆ é™¤è€Œä¸å½±å“åŸæœ‰åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸï¼ˆæ¨¡å—åŒ–é‡æ„ï¼‰
1. åˆ›å»º `ToolExecutor` æ¥å£
2. å®ç° `ToolRegistry` å·¥å…·æ³¨å†Œå™¨
3. ä»æ•°æ®åº“åŠ è½½å·¥å…·å®šä¹‰
4. æ”¯æŒå¸¦å‚æ•°çš„å·¥å…·ï¼ˆå¦‚å¤©æ°”æŸ¥è¯¢ã€è®¡ç®—å™¨ï¼‰

### ä¸­æœŸï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
1. å·¥å…·ç®¡ç† CRUD API
2. å‰ç«¯å·¥å…·ç®¡ç†ç•Œé¢
3. å·¥å…·è°ƒç”¨å†å²è®°å½•
4. å·¥å…·æ‰§è¡Œæƒé™æ§åˆ¶

### é•¿æœŸï¼ˆé«˜çº§ç‰¹æ€§ï¼‰
1. å·¥å…·ç¼–æ’ï¼ˆå¤šå·¥å…·ååŒï¼‰
2. å·¥å…·ç‰ˆæœ¬ç®¡ç†
3. å·¥å…·æ€§èƒ½ç›‘æ§
4. è‡ªå®šä¹‰å·¥å…·å¼€å‘ SDK

---

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•

```bash
# ä½¿ç”¨æµ‹è¯•è„šæœ¬
./test-tool-calling.sh

# æˆ–æ‰‹åŠ¨è°ƒç”¨
curl -X POST http://localhost:8080/api/chat/with-tools \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [{"role": "user", "content": "è¯·è°ƒç”¨ hello_pox å·¥å…·"}],
    "model": "glm-4.5"
  }'
```

### æ—¥å¿—æŸ¥çœ‹

æŸ¥çœ‹åº”ç”¨æ—¥å¿—å¯ä»¥çœ‹åˆ°å®Œæ•´çš„å·¥å…·è°ƒç”¨æµç¨‹ï¼š
```
å¼€å§‹å·¥å…·è°ƒç”¨å¯¹è¯è¯·æ±‚ï¼Œæ¨¡å‹: glm-4.5
å®šä¹‰å·¥å…·: hello_pox
ç¬¬ä¸€æ¬¡è°ƒç”¨ AI - åˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·è°ƒç”¨
AI è¯·æ±‚è°ƒç”¨å·¥å…·ï¼Œæ•°é‡: 1
å·¥å…·åç§°: hello_pox, å·¥å…·è°ƒç”¨ID: xxx
æ‰§è¡Œ HelloPox å·¥å…·
å·¥å…·æ‰§è¡ŒæˆåŠŸï¼Œç»“æœ: hello pox
æ„å»ºå·¥å…·ç»“æœæ¶ˆæ¯ï¼Œå‡†å¤‡ç¬¬äºŒæ¬¡è°ƒç”¨ AI
ç¬¬äºŒæ¬¡è°ƒç”¨ AI - åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”
å·¥å…·è°ƒç”¨å¯¹è¯å®Œæˆï¼Œæœ€ç»ˆå“åº”ID: xxx
```

---

## âœ¨ æˆåŠŸæ ‡å‡† - å…¨éƒ¨è¾¾æˆï¼

- âœ… AI èƒ½è¯†åˆ«å·¥å…·è°ƒç”¨éœ€æ±‚
- âœ… å·¥å…·æˆåŠŸæ‰§è¡Œå¹¶è¿”å› "hello pox"
- âœ… AI åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”
- âœ… æ—¥å¿—æ¸…æ™°æ˜¾ç¤ºå·¥å…·è°ƒç”¨æµç¨‹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•

---

**åˆ›å»ºæ—¶é—´**: 2025-10-25  
**çŠ¶æ€**: âœ… POC éªŒè¯æˆåŠŸï¼Œå¯ä»¥è¿›å…¥æ¨¡å—åŒ–å¼€å‘é˜¶æ®µ


