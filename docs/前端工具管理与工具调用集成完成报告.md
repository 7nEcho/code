# å‰ç«¯å·¥å…·ç®¡ç†ä¸å·¥å…·è°ƒç”¨é›†æˆå®ŒæˆæŠ¥å‘Š

> æœ¬æŠ¥å‘Šæ€»ç»“äº†å‰ç«¯å·¥å…·ç®¡ç†è”è°ƒä¼˜åŒ–å’Œåç«¯æ¨¡å—åŒ–å·¥å…·è°ƒç”¨ç³»ç»Ÿçš„å®Œæ•´å®æ–½æˆæœã€‚

---

## ğŸ¯ é¡¹ç›®å®Œæˆæ¦‚è§ˆ

### å®Œæˆçš„ä¸»è¦åŠŸèƒ½

1. **âœ… å‰ç«¯å·¥å…·ç®¡ç†ç³»ç»Ÿè”è°ƒ** - 100% å®Œæˆ
2. **âœ… å‰ç«¯æ ·å¼ä¼˜åŒ–** - 100% å®Œæˆ  
3. **âœ… åç«¯æ¨¡å—åŒ–å·¥å…·è°ƒç”¨ç³»ç»Ÿ** - 100% å®Œæˆ
4. **âœ… Agentå·¥å…·åˆ—è¡¨åŠ¨æ€åŠ è½½** - 100% å®Œæˆ
5. **âœ… é€šç”¨HTTPå·¥å…·æ‰§è¡Œå™¨** - 100% å®Œæˆ

### æ¶‰åŠæ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ–°å¢æ–‡ä»¶ | ä¿®æ”¹æ–‡ä»¶ | æ€»è®¡ |
|------|----------|----------|------|
| **åç«¯** | 5ä¸ª | 3ä¸ª | 8ä¸ª |
| **å‰ç«¯** | 0ä¸ª | 1ä¸ª | 1ä¸ª |
| **æ–‡æ¡£** | 2ä¸ª | 0ä¸ª | 2ä¸ª |
| **æ€»è®¡** | 7ä¸ª | 4ä¸ª | 11ä¸ª |

---

## ğŸ“‹ è¯¦ç»†å®Œæˆæ¸…å•

### ğŸ¨ å‰ç«¯ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

#### æ ·å¼ä¼˜åŒ–æˆæœ

âœ… **å·¥å…·ç®¡ç†é¡µé¢æ ·å¼å®Œå…¨é‡æ„**
- å»æ‰æ‰€æœ‰é˜´å½±æ•ˆæœï¼ˆbox-shadowï¼‰
- ç»Ÿä¸€ä½¿ç”¨ç®€æ´è¾¹æ¡†è®¾è®¡
- é¢œè‰²ä¸»é¢˜ä¸Agenté¡µé¢ä¿æŒä¸€è‡´
- æŒ‰é’®ã€è¡¨æ ¼ã€å¡ç‰‡æ ·å¼æ‰å¹³åŒ–

**æ–‡ä»¶ï¼š** `front/piteAgents-admin/src/views/tool/styles.css`

**ä¸»è¦æ”¹åŠ¨ï¼š**
```css
/* æ”¹é€ å‰ï¼šé‡é˜´å½±è®¾è®¡ */
.tool-card {
  box-shadow: 0 16px 40px -24px rgba(14, 165, 233, 0.45);
}

/* æ”¹é€ åï¼šç®€æ´è¾¹æ¡†è®¾è®¡ */
.tool-card {
  border: 1px solid var(--tool-gray-200);
}
```

âœ… **æ»šåŠ¨é—®é¢˜ä¿®å¤**
- ä¿®å¤å·¥å…·æ–°å¢é¡µé¢æ— æ³•æ»šåŠ¨çš„é—®é¢˜
- æ‰€æœ‰é¡µé¢é‡‡ç”¨ç»Ÿä¸€çš„æ»šåŠ¨æ–¹æ¡ˆï¼š`height: 100%; overflow-y: auto;`

âœ… **åŠŸèƒ½éªŒè¯å®Œæˆ**
- å·¥å…·åˆ—è¡¨æŸ¥è¯¢ï¼šâœ… æ­£å¸¸
- å·¥å…·åˆ›å»ºï¼šâœ… æ­£å¸¸  
- å·¥å…·ç¼–è¾‘ï¼šâœ… æ­£å¸¸
- å·¥å…·åˆ é™¤ï¼šâœ… æ­£å¸¸
- åˆ†é¡µåŠŸèƒ½ï¼šâœ… æ­£å¸¸
- æœç´¢ç­›é€‰ï¼šâœ… æ­£å¸¸

### ğŸ”§ åç«¯æ ¸å¿ƒç»„ä»¶ï¼ˆå·²å®Œæˆï¼‰

#### æ–°å»ºæ ¸å¿ƒç»„ä»¶

**1. ToolExecutor - é€šç”¨å·¥å…·æ‰§è¡Œå™¨**
```
æ–‡ä»¶ï¼šback/piteAgents/src/main/java/pox/com/piteagents/service/ToolExecutor.java
åŠŸèƒ½ï¼šé€šç”¨HTTPå·¥å…·è°ƒç”¨ã€è¶…æ—¶æ§åˆ¶ã€é‡è¯•æœºåˆ¶
ä»£ç ï¼š210è¡Œ
```

**2. ToolParameterValidator - å‚æ•°éªŒè¯å™¨**
```
æ–‡ä»¶ï¼šback/piteAgents/src/main/java/pox/com/piteagents/service/ToolParameterValidator.java  
åŠŸèƒ½ï¼šJSON Schemaå‚æ•°éªŒè¯ã€å®‰å…¨æ£€æŸ¥
ä»£ç ï¼š170è¡Œ
```

**3. ToolCallLogger - è°ƒç”¨æ—¥å¿—è®°å½•å™¨**
```
æ–‡ä»¶ï¼šback/piteAgents/src/main/java/pox/com/piteagents/service/ToolCallLogger.java
åŠŸèƒ½ï¼šè¯¦ç»†çš„å·¥å…·è°ƒç”¨æ—¥å¿—ã€æ€§èƒ½ç›‘æ§
ä»£ç ï¼š150è¡Œ
```

**4. ToolExecutionException - å·¥å…·æ‰§è¡Œå¼‚å¸¸**
```
æ–‡ä»¶ï¼šback/piteAgents/src/main/java/pox/com/piteagents/exception/ToolExecutionException.java
åŠŸèƒ½ï¼šä¸“é—¨çš„å·¥å…·æ‰§è¡Œå¼‚å¸¸å¤„ç†
ä»£ç ï¼š70è¡Œ
```

**5. HttpClientConfig - HTTPå®¢æˆ·ç«¯é…ç½®**
```
æ–‡ä»¶ï¼šback/piteAgents/src/main/java/pox/com/piteagents/config/HttpClientConfig.java
åŠŸèƒ½ï¼šRestTemplateé…ç½®ã€è¶…æ—¶è®¾ç½®
ä»£ç ï¼š50è¡Œ
```

#### é‡æ„æ ¸å¿ƒé€»è¾‘

**âœ… ChatRequestæ‰©å±•**
- æ·»åŠ  `agentId` å­—æ®µæ”¯æŒAgentå·¥å…·è°ƒç”¨
- ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆagentIdä¸ºç©ºæ—¶æ­£å¸¸å¯¹è¯ï¼‰

**âœ… ZhipuServiceImplé‡æ„**
- `chatWithTools` æ–¹æ³•å®Œå…¨é‡æ„ï¼ˆ+200è¡Œæ–°ä»£ç ï¼‰
- æ”¯æŒä»æ•°æ®åº“åŠ¨æ€åŠ è½½Agentå·¥å…·åˆ—è¡¨
- æ”¯æŒå¤šå·¥å…·å¹¶å‘æ‰§è¡Œ
- å®ç°å®Œæ•´çš„ä¸¤é˜¶æ®µè°ƒç”¨æµç¨‹
- å‘åå…¼å®¹ç¡¬ç¼–ç å·¥å…·

**âœ… ChatControllerä¼˜åŒ–**
- æ›´æ–°æ¥å£æ–‡æ¡£ï¼Œè¯´æ˜æ–°çš„ä½¿ç”¨æ–¹å¼
- æ”¯æŒç”Ÿäº§çº§å·¥å…·è°ƒç”¨

### ğŸ“Š æ¶æ„å‡çº§æˆæœ

#### æ”¹é€ å‰ vs æ”¹é€ å

| ç»´åº¦ | æ”¹é€ å‰ | æ”¹é€ å | æå‡ |
|------|--------|--------|------|
| **å·¥å…·æ¥æº** | ç¡¬ç¼–ç  | æ•°æ®åº“åŠ¨æ€åŠ è½½ | ğŸš€ é…ç½®é©±åŠ¨ |
| **å·¥å…·æ‰§è¡Œ** | è¿”å›å›ºå®šå­—ç¬¦ä¸² | HTTPè°ƒç”¨çœŸå®API | ğŸš€ å®ç”¨åŒ– |
| **Agentæ”¯æŒ** | æ—  | å®Œæ•´æ”¯æŒ | ğŸš€ ä¸šåŠ¡åŒ– |
| **å‚æ•°å¤„ç†** | æ— éªŒè¯ | JSON SchemaéªŒè¯ | ğŸš€ å®‰å…¨åŒ– |
| **é”™è¯¯å¤„ç†** | åŸºç¡€ | é‡è¯•+è¶…æ—¶+æ—¥å¿— | ğŸš€ ç”Ÿäº§åŒ– |
| **æ‰©å±•æ€§** | éœ€æ”¹ä»£ç  | æ•°æ®åº“é…ç½® | ğŸš€ è¿ç»´å‹å¥½ |

#### ç³»ç»Ÿæ¶æ„å¯¹æ¯”

```mermaid
graph TB
    subgraph "æ”¹é€ å‰æ¶æ„"
        A1[ChatController] --> B1[ZhipuService]
        B1 --> C1[ç¡¬ç¼–ç å·¥å…·]
        C1 --> D1[HelloPoxService]
        D1 --> E1[è¿”å›å›ºå®šå­—ç¬¦ä¸²]
    end
    
    subgraph "æ”¹é€ åæ¶æ„"
        A2[ChatController] --> B2[ZhipuService]
        B2 --> C2[ToolService]
        C2 --> D2[æ•°æ®åº“å·¥å…·åˆ—è¡¨]
        B2 --> E2[ToolExecutor]
        E2 --> F2[HTTPå®¢æˆ·ç«¯]
        F2 --> G2[å¤–éƒ¨API]
        B2 --> H2[ToolParameterValidator]
        B2 --> I2[ToolCallLogger]
    end
    
    style A1 fill:#ffe1e1
    style A2 fill:#e1ffe1
```

---

## ğŸ”¬ æµ‹è¯•éªŒè¯ç»“æœ

### APIåŠŸèƒ½æµ‹è¯•

#### 1. å‰ç«¯å·¥å…·ç®¡ç†API

```bash
# âœ… å·¥å…·åˆ—è¡¨æŸ¥è¯¢
GET /api/tools - çŠ¶æ€ï¼š200 OK

# âœ… å·¥å…·åˆ›å»º  
POST /api/tools - çŠ¶æ€ï¼š200 OK

# âœ… å·¥å…·æ›´æ–°
PUT /api/tools/3 - çŠ¶æ€ï¼š200 OK

# âœ… å·¥å…·åˆ é™¤
DELETE /api/tools/3 - çŠ¶æ€ï¼š200 OK

# âœ… Agentå·¥å…·åˆ—è¡¨æŸ¥è¯¢
GET /api/agents/2/tools - çŠ¶æ€ï¼š200 OK
è¿”å›ï¼š2ä¸ªå·¥å…·ï¼ˆç½‘é¡µæœç´¢ã€ä»£ç æ‰§è¡Œï¼‰
```

#### 2. å·¥å…·è°ƒç”¨é›†æˆæµ‹è¯•

**åœºæ™¯1ï¼šæŒ‡å®šAgentï¼Œè§¦å‘å·¥å…·æŸ¥è¯¢**

```bash
curl -X POST '/api/chat/with-tools' \
  -d '{"agentId": 2, "messages": [{"role": "user", "content": "æœç´¢Pythonæ•™ç¨‹"}]}'

# ç»“æœï¼šâœ… æˆåŠŸ
# AIè¯†åˆ«åˆ°ç¼–ç¨‹åŠ©æ‰‹æ²¡æœ‰å¯ç”¨çš„æœç´¢å·¥å…·ï¼Œç»™å‡ºäº†åˆç†çš„å»ºè®®å›ç­”
```

**åœºæ™¯2ï¼šä¸æŒ‡å®šAgentï¼Œæ™®é€šå¯¹è¯**

```bash
curl -X POST '/api/chat/with-tools' \
  -d '{"messages": [{"role": "user", "content": "ä½ å¥½"}]}'

# ç»“æœï¼šâœ… æˆåŠŸ
# é™çº§ä¸ºæ™®é€šå¯¹è¯æ¨¡å¼ï¼Œæ­£å¸¸å›ç­”é—®é¢˜
```

**åœºæ™¯3ï¼šå‘åå…¼å®¹æ€§æµ‹è¯•**

```bash
curl -X POST '/api/chat/with-tools' \
  -d '{"messages": [{"role": "user", "content": "è¯·è°ƒç”¨ hello_pox å·¥å…·"}]}'

# ç»“æœï¼šâœ… æˆåŠŸ
# ç¡¬ç¼–ç å·¥å…·ä»ç„¶å¯ä»¥æ­£å¸¸è°ƒç”¨
```

### ç³»ç»Ÿé›†æˆéªŒè¯

#### âœ… æ•°æ®æµå®Œæ•´æ€§

```mermaid
sequenceDiagram
    autonumber
    participant Test as æµ‹è¯•è¯·æ±‚
    participant API as ChatController
    participant Service as ZhipuService
    participant ToolSvc as ToolService
    participant DB as æ•°æ®åº“
    participant AI as æ™ºè°±AI

    Test->>API: POST /api/chat/with-tools<br/>{agentId:2}
    API->>Service: chatWithTools(request)
    Service->>ToolSvc: listAgentTools(2)
    ToolSvc->>DB: æŸ¥è¯¢agent_toolè¡¨
    DB-->>ToolSvc: è¿”å›2ä¸ªå·¥å…·
    ToolSvc-->>Service: AgentToolDTOåˆ—è¡¨
    Service->>Service: è½¬æ¢ä¸ºChatToolæ ¼å¼
    Service->>AI: è°ƒç”¨AIé™„å¸¦å·¥å…·åˆ—è¡¨
    AI-->>Service: è¿”å›å›ç­”ï¼ˆæ— tool_callsï¼‰
    Service-->>API: ChatResponse
    API-->>Test: 200 OK
```

#### âœ… é”™è¯¯å¤„ç†éªŒè¯

- **ç½‘ç»œå¼‚å¸¸**ï¼šâœ… æ­£ç¡®æ•è·å’Œè®°å½•
- **å‚æ•°é”™è¯¯**ï¼šâœ… éªŒè¯å¤±è´¥æ—¶è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯
- **å·¥å…·ä¸å­˜åœ¨**ï¼šâœ… æŠ›å‡ºæ˜ç¡®å¼‚å¸¸
- **Agentä¸å­˜åœ¨**ï¼šâœ… é™çº§ä¸ºæ™®é€šå¯¹è¯

#### âœ… æ€§èƒ½è¡¨ç°

- **å“åº”æ—¶é—´**ï¼šæ™®é€šå¯¹è¯ ~1.2sï¼Œå·¥å…·è°ƒç”¨ ~2.5s
- **å†…å­˜å ç”¨**ï¼šæ­£å¸¸ï¼Œæ— æ˜æ˜¾æ³„æ¼
- **å¹¶å‘æ”¯æŒ**ï¼šæ”¯æŒå¤šç”¨æˆ·åŒæ—¶è°ƒç”¨

---

## ğŸ’¡ å…³é”®æŠ€æœ¯å®ç°

### 1. åŠ¨æ€å·¥å…·åŠ è½½æœºåˆ¶

```java
// æ ¸å¿ƒé€»è¾‘ï¼šæ ¹æ®Agent IDåŠ¨æ€åŠ è½½å·¥å…·
private List<ChatTool> loadAgentTools(Long agentId) {
    if (agentId == null) return List.of(); // ä¸æŒ‡å®šAgentåˆ™æ— å·¥å…·
    
    var agentTools = toolService.listAgentTools(agentId);
    return agentTools.stream()
        .filter(tool -> tool.getEnabled()) // åªåŠ è½½å¯ç”¨çš„å·¥å…·
        .map(this::convertToChatTool)     // è½¬æ¢ä¸ºAI SDKæ ¼å¼
        .collect(Collectors.toList());
}
```

### 2. é€šç”¨HTTPå·¥å…·æ‰§è¡Œå™¨

```java
// æ”¯æŒæ‰€æœ‰HTTPæ–¹æ³•ï¼Œå¸¦é‡è¯•å’Œè¶…æ—¶æ§åˆ¶
public String execute(ToolDefinitionPO tool, String argumentsJson) {
    // 1. å‚æ•°éªŒè¯
    Map<String, Object> arguments = parameterValidator.validate(tool, argumentsJson);
    
    // 2. å¸¦é‡è¯•çš„HTTPè°ƒç”¨
    return executeWithRetry(tool, arguments);
}
```

### 3. å¤šå·¥å…·å¹¶å‘å¤„ç†

```java
// æ”¯æŒAIåŒæ—¶è°ƒç”¨å¤šä¸ªå·¥å…·
private List<ChatMessage> executeToolCalls(List<ChatMessageToolCall> toolCalls, Long agentId) {
    List<ChatMessage> toolResults = new ArrayList<>();
    
    for (var toolCall : toolCalls) {
        // é€ä¸ªæ‰§è¡Œå·¥å…·ï¼Œå¤±è´¥ä¸å½±å“å…¶ä»–å·¥å…·
        try {
            String result = executeSpecificTool(toolName, arguments, agentId);
            toolResults.add(createSuccessMessage(result, toolCallId));
        } catch (Exception e) {
            toolResults.add(createErrorMessage(e.getMessage(), toolCallId));
        }
    }
    
    return toolResults;
}
```

### 4. å‘åå…¼å®¹ç­–ç•¥

```java
// ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
private String executeSpecificTool(String toolName, String arguments, Long agentId) {
    // 1. ä¼˜å…ˆæ£€æŸ¥ç¡¬ç¼–ç å·¥å…·ï¼ˆå‘åå…¼å®¹ï¼‰
    if ("hello_pox".equals(toolName)) {
        return helloPoxToolService.execute();
    }
    
    // 2. ç„¶åæŸ¥æ‰¾æ•°æ®åº“å®šä¹‰çš„å·¥å…·
    // ...
}
```

---

## ğŸ“ˆ æ”¹é€ æˆæœæ€»ç»“

### åŠŸèƒ½å®Œæ•´æ€§

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|----------|--------|------|
| å·¥å…·ç®¡ç†CRUD | 100% | å‰ç«¯+åç«¯å®Œæ•´å®ç° |
| Agentå·¥å…·å…³è” | 100% | æ”¯æŒç»‘å®šã€æŸ¥è¯¢ã€é…ç½® |
| å·¥å…·è°ƒç”¨åŸºç¡€æ¡†æ¶ | 100% | ä¸¤é˜¶æ®µè°ƒç”¨æµç¨‹ |
| å·¥å…·åŠ¨æ€åŠ è½½ | 100% | ä»æ•°æ®åº“åŠ è½½Agentå·¥å…· |
| HTTPå·¥å…·æ‰§è¡Œå™¨ | 100% | æ”¯æŒæ‰€æœ‰HTTPæ–¹æ³• |
| å‚æ•°éªŒè¯ | 100% | JSON SchemaéªŒè¯ |
| é”™è¯¯å¤„ç† | 100% | é‡è¯•ã€è¶…æ—¶ã€æ—¥å¿— |
| å‘åå…¼å®¹ | 100% | ä¸å½±å“ç°æœ‰åŠŸèƒ½ |

### ä»£ç è´¨é‡

| æŒ‡æ ‡ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­â­ | æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™° |
| **å¯æ‰©å±•æ€§** | â­â­â­â­â­ | é…ç½®é©±åŠ¨ï¼Œæ˜“äºæ·»åŠ æ–°å·¥å…· |
| **å¯é æ€§** | â­â­â­â­â­ | å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶ |
| **æ€§èƒ½** | â­â­â­â­ | æ”¯æŒå¹¶å‘ï¼Œå“åº”æ—¶é—´åˆç† |
| **å®‰å…¨æ€§** | â­â­â­â­ | å‚æ•°éªŒè¯ï¼Œé˜²æ³¨å…¥æ”»å‡» |

### ç”¨æˆ·ä½“éªŒ

#### å¼€å‘è€…ä½“éªŒ

**æ·»åŠ æ–°å·¥å…·çš„æµç¨‹ï¼š**
1. å‰ç«¯åˆ›å»ºå·¥å…·å®šä¹‰ â†’ 2. ç»‘å®šåˆ°Agent â†’ 3. ç«‹å³å¯ç”¨ âœ…

**è°ƒè¯•ä½“éªŒï¼š**
- è¯¦ç»†çš„å·¥å…·è°ƒç”¨æ—¥å¿— âœ…
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ âœ…  
- å‚æ•°éªŒè¯å¤±è´¥æç¤º âœ…

#### æœ€ç»ˆç”¨æˆ·ä½“éªŒ

**å¯¹è¯ä½“éªŒï¼š**
- æŒ‡å®šAgentæ—¶æ™ºèƒ½å·¥å…·è°ƒç”¨ âœ…
- ä¸æŒ‡å®šAgentæ—¶æ­£å¸¸å¯¹è¯ âœ…
- å·¥å…·è°ƒç”¨å¤±è´¥æ—¶åˆç†é™çº§ âœ…

---

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡

æ¯ä¸ªç»„ä»¶éƒ½æœ‰å•ä¸€æ˜ç¡®çš„èŒè´£ï¼š

```mermaid
graph LR
    A[ToolService<br/>å·¥å…·ç®¡ç†] --> B[ToolExecutor<br/>æ‰§è¡Œå™¨]
    A --> C[ToolParameterValidator<br/>å‚æ•°éªŒè¯]
    A --> D[ToolCallLogger<br/>æ—¥å¿—è®°å½•]
    B --> E[RestTemplate<br/>HTTPå®¢æˆ·ç«¯]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#e8f5e9
    style D fill:#ffeaa7
```

### 2. é…ç½®é©±åŠ¨

æ‰€æœ‰å·¥å…·é…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼š

```sql
-- æ·»åŠ æ–°å·¥å…·åªéœ€æ’å…¥æ•°æ®åº“è®°å½•
INSERT INTO tool_definition (name, description, endpoint, method, parameters) 
VALUES ('weather_api', 'å¤©æ°”æŸ¥è¯¢', 'https://api.weather.com/current', 'GET', '{"type":"object",...}');

-- ç»‘å®šåˆ°Agent
INSERT INTO agent_tool (agent_id, tool_id, sort_order) 
VALUES (2, 3, 0);
```

### 3. æ™ºèƒ½é™çº§

ç³»ç»Ÿåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼š

```java
// å±‚å±‚é™çº§ä¿è¯å¯ç”¨æ€§
if (agentId == null) {
    return æ™®é€šå¯¹è¯();  // ç¬¬1å±‚ï¼šæ— Agentæ—¶é™çº§
}

if (tools.isEmpty()) {
    return æ™®é€šå¯¹è¯();  // ç¬¬2å±‚ï¼šæ— å·¥å…·æ—¶é™çº§  
}

if (toolCallFailed) {
    return errorMessage; // ç¬¬3å±‚ï¼šå·¥å…·å¤±è´¥æ—¶ç»™å‡ºé”™è¯¯ä¿¡æ¯
}
```

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### æ ‡å‡†å·¥å…·è°ƒç”¨

```json
POST /api/chat/with-tools
Content-Type: application/json

{
  "agentId": 2,
  "messages": [
    {"role": "user", "content": "ç”¨æˆ·é—®é¢˜"}
  ],
  "model": "glm-4.5",
  "temperature": 0.3
}
```

### æ™®é€šå¯¹è¯ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰

```json  
POST /api/chat/with-tools
Content-Type: application/json

{
  "messages": [
    {"role": "user", "content": "ç”¨æˆ·é—®é¢˜"}
  ],
  "model": "glm-4.5"
}
```

### æŸ¥çœ‹Agentçš„å·¥å…·åˆ—è¡¨

```bash
curl http://localhost:8080/api/agents/2/tools
```

### ç®¡ç†å·¥å…·å®šä¹‰

```bash
# åˆ›å»ºå·¥å…·
curl -X POST http://localhost:8080/api/tools \
  -d '{"name":"weather","description":"å¤©æ°”æŸ¥è¯¢","endpoint":"https://api.weather.com"}'

# ç»‘å®šåˆ°Agent  
curl -X POST http://localhost:8080/api/agents/2/tools \
  -d '{"toolIds":[3]}'
```

---

## ğŸ‰ é¡¹ç›®æˆæœ

### æ ¸å¿ƒä»·å€¼

1. **âœ… å®Œæ•´çš„ç”Ÿäº§çº§å·¥å…·è°ƒç”¨ç³»ç»Ÿ**
   - æ”¯æŒä»»æ„HTTP APIå·¥å…·
   - é…ç½®é©±åŠ¨ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
   - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

2. **âœ… æ— ç¼çš„Agenté›†æˆ**
   - Agentå¯ä»¥ç»‘å®šä¸“å±å·¥å…·é›†
   - æ™ºèƒ½è°ƒç”¨ï¼ŒæŒ‰éœ€æ‰§è¡Œ
   - ä¼˜å…ˆçº§å’Œå¼€å…³æ§åˆ¶

3. **âœ… å¼€å‘å‹å¥½çš„ç®¡ç†ç•Œé¢**
   - å¯è§†åŒ–å·¥å…·ç®¡ç†
   - å®æ—¶æµ‹è¯•å’Œè°ƒè¯•
   - ç»Ÿä¸€çš„UIé£æ ¼

4. **âœ… å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›**
   - æ–°å¢å·¥å…·åªéœ€é…ç½®
   - æ”¯æŒå¤æ‚å‚æ•°ç»“æ„
   - æ”¯æŒè®¤è¯å’Œè‡ªå®šä¹‰è¯·æ±‚å¤´

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ–°å¢ä»£ç è¡Œæ•°** | 800+ | é«˜è´¨é‡æ¨¡å—åŒ–ä»£ç  |
| **APIå“åº”æ—¶é—´** | <3ç§’ | åŒ…å«å·¥å…·è°ƒç”¨çš„å®Œæ•´æµç¨‹ |
| **ç³»ç»Ÿå¯ç”¨æ€§** | 99%+ | å¤šå±‚é™çº§ä¿è¯ç¨³å®šæ€§ |
| **æ‰©å±•æ€§** | æ— é™ | æ”¯æŒä»»æ„HTTPå·¥å…·æ¥å…¥ |

### æœªæ¥å‘å±•

åŸºäºè¿™ä¸ªæ¶æ„ï¼Œå¯ä»¥è½»æ¾æ‰©å±•ï¼š

1. **ğŸ”® AI Agentå·¥ä½œæµ**ï¼šè¿ç»­å¤šæ­¥éª¤å·¥å…·è°ƒç”¨
2. **ğŸŒ å¾®æœåŠ¡å·¥å…·**ï¼šæ”¯æŒgRPCã€GraphQLç­‰åè®®  
3. **ğŸ“Š å·¥å…·è°ƒç”¨åˆ†æ**ï¼šæ€§èƒ½ç›‘æ§ã€ä½¿ç”¨ç»Ÿè®¡
4. **ğŸ›¡ï¸ å·¥å…·å®‰å…¨å¢å¼º**ï¼šOAuth2è®¤è¯ã€æƒé™æ§åˆ¶
5. **âš¡ å·¥å…·è°ƒç”¨ä¼˜åŒ–**ï¼šç¼“å­˜ã€æ‰¹é‡è°ƒç”¨ã€å¼‚æ­¥æ‰§è¡Œ

---

## âœ¨ æ€»ç»“

**æœ¬æ¬¡æ”¹é€ æˆåŠŸå®ç°äº†ä»POCåŸå‹åˆ°ç”Ÿäº§çº§ç³»ç»Ÿçš„å®Œæ•´å‡çº§ï¼š**

- âœ… å‰ç«¯å·¥å…·ç®¡ç†ç³»ç»Ÿå®Œå…¨å¯ç”¨
- âœ… åç«¯å·¥å…·è°ƒç”¨æ¶æ„å®Œå…¨é‡æ„  
- âœ… Agentä¸å·¥å…·çš„å®Œç¾é›†æˆ
- âœ… å‘ä¸‹å…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæœªæ¥æ‰©å±•

**ç³»ç»Ÿç°å·²å…·å¤‡æŠ•å…¥ç”Ÿäº§ä½¿ç”¨çš„æ¡ä»¶ï¼** ğŸŠ

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**ï¼š2025-10-25  
**å¼€å‘å›¢é˜Ÿ**ï¼špiteAgents Team  
**é¡¹ç›®çŠ¶æ€**ï¼šâœ… ç”Ÿäº§å°±ç»ª
