Agent 管理系统开发计划
技术架构
技术栈
后端框架: Spring Boot 3.5.x + Java 17
数据持久化: MySQL 8.0+ + Spring Data JPA
数据库迁移: Flyway
API 文档: SpringDoc OpenAPI 3.0
AI SDK: 智谱 AI SDK 0.0.6
测试框架: JUnit 5 + Mockito
核心模块
Agent 基础管理（CRUD、分类、状态）
提示词管理（系统/角色/知识库提示词）
参数配置管理（模型、温度、Token 等）
对话历史管理（会话、消息记录）
工具调用管理（工具定义、关联、日志）
知识库集成（文档管理、关联）
数据库设计
核心表结构
agent: Agent 基础信息（id, name, description, avatar, category, status, system_prompt, created_at, updated_at）
agent_config: Agent 参数配置（id, agent_id, model, temperature, max_tokens, top_p）
conversation_session: 会话表（id, agent_id, title, created_at, updated_at）
conversation_message: 消息记录（id, session_id, role, content, tokens, created_at）
tool_definition: 工具定义（id, name, description, endpoint, parameters）
agent_tool: Agent 工具关联（agent_id, tool_id）
knowledge_base: 知识库（id, name, description, content）
agent_knowledge: Agent 知识库关联（agent_id, knowledge_id）
开发步骤
第一阶段：基础设施
添加 MySQL、JPA、Flyway 依赖到 pom.xml
配置数据库连接信息到 application.yml
创建 Flyway 数据库迁移脚本
创建基础实体类（Entity）
第二阶段：Agent 核心功能
创建 Agent 实体和 DTO
entity/Agent.java
entity/AgentConfig.java
dto/AgentDTO.java
dto/AgentCreateRequest.java
dto/AgentUpdateRequest.java
创建 Repository 层
repository/AgentRepository.java
repository/AgentConfigRepository.java
创建 Service 层
service/AgentService.java（CRUD + 业务逻辑）
创建 Controller 层
controller/AgentController.java（REST API）
编写单元测试
service/AgentServiceTest.java
controller/AgentControllerTest.java
第三阶段：对话历史管理
创建会话和消息实体
entity/ConversationSession.java
entity/ConversationMessage.java
创建历史管理 Service
service/ConversationService.java
集成到现有 ZhipuService，在对话时自动保存历史
创建历史查询接口
controller/ConversationController.java
第四阶段：进阶功能
工具管理
entity/ToolDefinition.java
entity/AgentTool.java
service/ToolService.java
controller/ToolController.java
知识库管理
entity/KnowledgeBase.java
entity/AgentKnowledge.java
service/KnowledgeService.java
controller/KnowledgeController.java
第五阶段：优化和文档
添加 API 文档注解（@Operation, @Schema 等）
编写集成测试
性能优化（索引、查询优化、缓存）
生成完整技术文档
API 设计概览
Agent 管理接口
POST /api/agents - 创建 Agent
GET /api/agents - 查询 Agent 列表
GET /api/agents/{id} - 获取 Agent 详情
PUT /api/agents/{id} - 更新 Agent
DELETE /api/agents/{id} - 删除 Agent
PUT /api/agents/{id}/config - 更新 Agent 配置
对话历史接口
GET /api/sessions - 获取会话列表
GET /api/sessions/{id} - 获取会话详情
GET /api/sessions/{id}/messages - 获取会话消息历史
DELETE /api/sessions/{id} - 删除会话
工具管理接口
POST /api/tools - 创建工具
GET /api/tools - 查询工具列表
PUT /api/agents/{agentId}/tools - 关联工具到 Agent
知识库接口
POST /api/knowledge - 创建知识库
GET /api/knowledge - 查询知识库列表
PUT /api/agents/{agentId}/knowledge - 关联知识库到 Agent
集成改造
需要改造现有的 ChatController 和 ZhipuService：

在对话请求中增加 agentId 参数
根据 Agent 配置动态设置模型参数和系统提示词
自动保存对话历史到数据库
支持加载历史对话作为上下文
To-dos
[ ] 添加 MySQL、JPA、Flyway 等依赖到 pom.xml
[ ] 配置数据库连接和 Flyway 迁移
[ ] 创建数据库迁移脚本（建表 SQL）
[ ] 创建 Agent 相关实体类和 DTO
[ ] 创建 Agent Repository 层
[ ] 实现 AgentService 业务逻辑
[ ] 创建 Agent REST API 接口
[ ] 编写 Agent 模块单元测试
[ ] 创建会话和消息实体
[ ] 实现对话历史管理 Service
[ ] 集成对话历史到现有 Chat 接口
[ ] 实现工具管理模块（Entity、Service、Controller）
[ ] 实现知识库管理模块（Entity、Service、Controller）
[ ] 添加 SpringDoc API 文档和注解
[ ] 生成技术设计文档（包含 Mermaid 图表）