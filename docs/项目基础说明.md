# PiteAgents é¡¹ç›®åŸºç¡€è¯´æ˜

## ç»Ÿä¸€åˆ†é¡µé…ç½®ä¸ä½¿ç”¨æŒ‡å—

### ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ **MyBatis-Plus åˆ†é¡µæ’ä»¶**å®ç°ç»Ÿä¸€çš„åˆ†é¡µåŠŸèƒ½ï¼Œé€šè¿‡ YAML é…ç½®å’Œå·¥å…·ç±»æä¾›ä¼˜é›…ã€å®‰å…¨ã€å¯é…ç½®çš„åˆ†é¡µç®¡ç†æ–¹æ¡ˆã€‚

---

## ä¸€ã€åç«¯åˆ†é¡µå®ç°

### 1.1 æŠ€æœ¯æ ˆ

- **åˆ†é¡µæ¡†æ¶**: MyBatis-Plus Pagination Plugin
- **é…ç½®ç®¡ç†**: Spring Boot Configuration Properties
- **å·¥å…·ç±»**: ç»Ÿä¸€åˆ†é¡µå·¥å…·ç±» `PaginationUtils`

### 1.2 YAML é…ç½®

åœ¨ `application.yml` ä¸­é…ç½®å…¨å±€åˆ†é¡µå‚æ•°ï¼š

```yaml
pite-agents:
  pagination:
    # é»˜è®¤é¡µé¢å¤§å°ï¼ˆå½“å‰ç«¯æœªä¼ å…¥ size å‚æ•°æ—¶ä½¿ç”¨ï¼‰
    default-page-size: 20
    
    # æœ€å¤§é¡µé¢å¤§å°ï¼ˆé˜²æ­¢æ¶æ„æŸ¥è¯¢ï¼Œè¶…è¿‡æ­¤å€¼å°†è¢«é™åˆ¶ï¼‰
    max-page-size: 1000
    
    # é»˜è®¤æ’åºå­—æ®µï¼ˆé©¼å³°å‘½åï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼‰
    default-sort-field: "createdAt"
    
    # é»˜è®¤æ’åºæ–¹å‘ (ASC/DESC)
    default-sort-direction: "DESC"
```

**é…ç½®è¯´æ˜**ï¼š
- `default-page-size`: æœªæŒ‡å®šé¡µé¢å¤§å°æ—¶çš„é»˜è®¤å€¼
- `max-page-size`: ç³»ç»Ÿå…è®¸çš„æœ€å¤§é¡µé¢å¤§å°ï¼Œè¶…è¿‡æ­¤å€¼ä¼šè¢«å¼ºåˆ¶é™åˆ¶
- `default-sort-field`: é»˜è®¤æ’åºå­—æ®µï¼Œä½¿ç”¨ Java é©¼å³°å‘½åï¼ˆå¦‚ `createdAt`ï¼‰
- `default-sort-direction`: é»˜è®¤æ’åºæ–¹å‘ï¼Œå¯é€‰å€¼ä¸º `ASC`ï¼ˆå‡åºï¼‰æˆ– `DESC`ï¼ˆé™åºï¼‰

### 1.3 æ ¸å¿ƒç»„ä»¶

#### 1.3.1 é…ç½®ç±» - `PaginationProperties`

ä½ç½®ï¼š`back/piteAgents/src/main/java/pox/com/piteagents/config/PaginationProperties.java`

```java
@Component
@ConfigurationProperties(prefix = "pite-agents.pagination")
public class PaginationProperties {
    private int defaultPageSize = 20;
    private int maxPageSize = 1000;
    private String defaultSortField = "createdAt";
    private String defaultSortDirection = "DESC";
    
    // æä¾›å®‰å…¨çš„å‚æ•°è·å–æ–¹æ³•
    public int getSafePageSize(Integer pageSize) { ... }
    public long getSafePageNum(Integer pageNum) { ... }
    public String getSafeSortField(String sortField) { ... }
    public String getSafeSortDirection(String sortDirection) { ... }
}
```

**èŒè´£**ï¼š
- è¯»å–å¹¶ç®¡ç† YAML é…ç½®
- æä¾›å‚æ•°å®‰å…¨æ ¡éªŒæ–¹æ³•
- ç¡®ä¿åˆ†é¡µå‚æ•°åœ¨åˆç†èŒƒå›´å†…

#### 1.3.2 å·¥å…·ç±» - `PaginationUtils`

ä½ç½®ï¼š`back/piteAgents/src/main/java/pox/com/piteagents/common/utils/PaginationUtils.java`

```java
@Component
public class PaginationUtils {
    
    // åˆ›å»ºåŸºç¡€åˆ†é¡µå¯¹è±¡
    public <T> IPage<T> createPage(Integer pageNum, Integer pageSize);
    
    // åˆ›å»ºå¸¦æ’åºçš„åˆ†é¡µå¯¹è±¡
    public <T> IPage<T> createPage(Integer pageNum, Integer pageSize, 
                                   String sortField, String sortDirection);
    
    // è®°å½•åˆ†é¡µä¿¡æ¯ï¼ˆç”¨äºæ—¥å¿—ï¼‰
    public void logPaginationInfo(IPage<?> page, String action);
}
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **å‚æ•°æ ¡éªŒ**ï¼šéªŒè¯å¹¶è§„èŒƒåŒ–åˆ†é¡µå‚æ•°
2. **å®‰å…¨æ£€æŸ¥**ï¼šæ’åºå­—æ®µç™½åå•éªŒè¯ï¼Œé˜²æ­¢ SQL æ³¨å…¥
3. **å­—æ®µè½¬æ¢**ï¼šè‡ªåŠ¨å°†é©¼å³°å‘½åè½¬æ¢ä¸ºæ•°æ®åº“ä¸‹åˆ’çº¿å‘½å
4. **é»˜è®¤å€¼å¤„ç†**ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å€¼å¡«å……ç¼ºå¤±å‚æ•°

**æ’åºå­—æ®µç™½åå•**ï¼š
```java
private static final Set<String> ALLOWED_SORT_FIELDS = new HashSet<>(Arrays.asList(
    "id", "createdAt", "updatedAt", "name", "title", "status", 
    "sortOrder", "priority", "messageCount", "totalTokens"
));
```

### 1.4 Controller å±‚ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ï¼šAgentController

```java
@RestController
@RequestMapping("/api/agents")
@RequiredArgsConstructor
public class AgentController {
    
    private final IAgentService agentService;
    private final PaginationUtils paginationUtils;
    
    @GetMapping
    public ApiResponse<IPage<AgentDTO>> listAgents(
            @RequestParam(required = false) String category,
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer page,      // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
            @RequestParam(required = false) Integer size,      // é¡µé¢å¤§å°ï¼ˆå¯é€‰ï¼Œä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼‰
            @RequestParam(required = false) String sortField,  // æ’åºå­—æ®µï¼ˆå¯é€‰ï¼‰
            @RequestParam(required = false) String sortDirection) { // æ’åºæ–¹å‘ï¼ˆå¯é€‰ï¼‰
        
        // ä½¿ç”¨å·¥å…·ç±»åˆ›å»ºåˆ†é¡µå¯¹è±¡
        IPage<AgentDTO> pageParam = paginationUtils.createPage(page, size, sortField, sortDirection);
        
        // è°ƒç”¨ Service å±‚æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
        IPage<AgentDTO> agents = agentService.listAgents(category, status, keyword, pageParam);
        
        // è®°å½•åˆ†é¡µä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
        paginationUtils.logPaginationInfo(agents, "æŸ¥è¯¢Agentåˆ—è¡¨");
        
        return ApiResponse.success(agents);
    }
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `page`: é¡µç ï¼Œ**ä» 1 å¼€å§‹**ï¼Œå¯é€‰ï¼ˆé»˜è®¤ä½¿ç”¨é…ç½®çš„ç¬¬ä¸€é¡µï¼‰
- `size`: æ¯é¡µå¤§å°ï¼Œå¯é€‰ï¼ˆé»˜è®¤ä½¿ç”¨ `default-page-size` é…ç½®ï¼‰
- `sortField`: æ’åºå­—æ®µï¼Œå¯é€‰ï¼ˆé»˜è®¤ä½¿ç”¨ `default-sort-field` é…ç½®ï¼‰
- `sortDirection`: æ’åºæ–¹å‘ï¼Œå¯é€‰å€¼ `ASC`/`DESC`ï¼ˆé»˜è®¤ä½¿ç”¨ `default-sort-direction` é…ç½®ï¼‰

### 1.5 Service å±‚ä½¿ç”¨ç¤ºä¾‹

#### æ¥å£å®šä¹‰

```java
public interface IAgentService {
    IPage<AgentDTO> listAgents(String category, String status, 
                               String keyword, IPage<AgentDTO> page);
}
```

#### å®ç°ç¤ºä¾‹

```java
@Override
@Transactional(readOnly = true)
public IPage<AgentDTO> listAgents(String category, String status, 
                                  String keyword, IPage<AgentDTO> page) {
    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
    LambdaQueryWrapper<AgentPO> queryWrapper = Wrappers.lambdaQuery();
    
    if (keyword != null && !keyword.trim().isEmpty()) {
        queryWrapper.and(wrapper -> wrapper
                .like(AgentPO::getName, keyword)
                .or()
                .like(AgentPO::getDescription, keyword)
        );
    }
    
    if (category != null && !category.trim().isEmpty()) {
        queryWrapper.eq(AgentPO::getCategory, category);
    }
    
    if (status != null && !status.trim().isEmpty()) {
        queryWrapper.eq(AgentPO::getStatus, status);
    }

    // åˆ›å»º MyBatis-Plus åˆ†é¡µå¯¹è±¡
    Page<AgentPO> mpPage = new Page<>(page.getCurrent(), page.getSize());
    
    // å¤åˆ¶æ’åºä¿¡æ¯
    if (page.orders() != null && !page.orders().isEmpty()) {
        mpPage.addOrder(page.orders());
    }
    
    // æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
    IPage<AgentPO> agentPage = agentMapper.selectPage(mpPage, queryWrapper);

    // è½¬æ¢ä¸º DTO å¹¶è¿”å›
    Page<AgentDTO> resultPage = new Page<>(agentPage.getCurrent(), 
                                           agentPage.getSize(), 
                                           agentPage.getTotal());
    resultPage.setRecords(agentPage.getRecords().stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList()));
    
    // å¤åˆ¶æ’åºä¿¡æ¯åˆ°ç»“æœ
    if (agentPage.orders() != null && !agentPage.orders().isEmpty()) {
        resultPage.addOrder(agentPage.orders());
    }
    
    return resultPage;
}
```

### 1.6 API è¯·æ±‚ç¤ºä¾‹

#### åŸºç¡€åˆ†é¡µæŸ¥è¯¢
```http
GET /api/agents?page=1&size=20
```

#### å¸¦æœç´¢æ¡ä»¶çš„åˆ†é¡µæŸ¥è¯¢
```http
GET /api/agents?category=ç¼–ç¨‹&status=ACTIVE&keyword=åŠ©æ‰‹&page=2&size=10
```

#### å¸¦æ’åºçš„åˆ†é¡µæŸ¥è¯¢
```http
GET /api/agents?page=1&size=20&sortField=updatedAt&sortDirection=DESC
```

#### å®Œæ•´å‚æ•°ç¤ºä¾‹
```http
GET /api/agents?category=ç¼–ç¨‹&status=ACTIVE&page=1&size=15&sortField=name&sortDirection=ASC
```

### 1.7 å“åº”æ ¼å¼

MyBatis-Plus åˆ†é¡µå“åº”ç»“æ„ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "é€šç”¨åŠ©æ‰‹",
        "description": "ä¸€ä¸ªé€šç”¨çš„ AI åŠ©æ‰‹",
        "category": "é€šç”¨",
        "status": "ACTIVE",
        "createdAt": "2025-10-24T03:29:42",
        "updatedAt": "2025-10-24T03:29:42",
        "config": {
          "model": "glm-4.6",
          "temperature": 0.7,
          "maxTokens": 2000,
          "topP": 0.95
        }
      }
    ],
    "total": 100,        // æ€»è®°å½•æ•°
    "size": 20,          // æ¯é¡µå¤§å°
    "current": 1,        // å½“å‰é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
    "pages": 5,          // æ€»é¡µæ•°
    "orders": [          // æ’åºä¿¡æ¯
      {
        "column": "created_at",
        "asc": false
      }
    ]
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `records`: å½“å‰é¡µçš„æ•°æ®åˆ—è¡¨
- `total`: æ€»è®°å½•æ•°
- `size`: æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°
- `current`: å½“å‰é¡µç ï¼ˆ**ä» 1 å¼€å§‹**ï¼‰
- `pages`: æ€»é¡µæ•°
- `orders`: æ’åºä¿¡æ¯æ•°ç»„

---

## äºŒã€å‰ç«¯åˆ†é¡µå®ç°

### 2.1 Agent åˆ—è¡¨é¡µé¢

ä½ç½®ï¼š`front/piteAgents-admin/src/views/agent/List.vue`

#### çŠ¶æ€ç®¡ç†

```javascript
const currentPage = ref(1)  // å½“å‰é¡µç ï¼Œä»1å¼€å§‹
const totalPages = ref(0)   // æ€»é¡µæ•°
const totalElements = ref(0) // æ€»è®°å½•æ•°

const searchParams = reactive({
  keyword: '',
  category: '',
  status: '',
  page: 1,                  // è¯·æ±‚é¡µç ï¼Œä»1å¼€å§‹
  size: 12,                 // æ¯é¡µå¤§å°
  sortField: '',            // æ’åºå­—æ®µï¼ˆå¯é€‰ï¼‰
  sortDirection: '',        // æ’åºæ–¹å‘ï¼ˆå¯é€‰ï¼‰
})
```

#### æ•°æ®åŠ è½½

```javascript
const loadAgents = async () => {
  try {
    loading.value = true
    const response = await getAgentList(searchParams)

    // å¤„ç† MyBatis-Plus åˆ†é¡µå“åº”
    const pageData = response.data
    agents.value = pageData.records || []      // æ•°æ®åˆ—è¡¨
    totalPages.value = pageData.pages || 0     // æ€»é¡µæ•°
    totalElements.value = pageData.total || 0  // æ€»è®°å½•æ•°
    currentPage.value = pageData.current || 1  // å½“å‰é¡µç 
  } catch (error) {
    console.error('åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}
```

#### åˆ†é¡µæ“ä½œ

```javascript
// ç¿»é¡µå¤„ç†
const handlePageChange = (page) => {
  searchParams.page = page
  loadAgents()
}

// æœç´¢å¤„ç†ï¼ˆé‡ç½®åˆ°ç¬¬ä¸€é¡µï¼‰
const handleSearch = () => {
  searchParams.page = 1  // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
  loadAgents()
}
```

#### æ¨¡æ¿ç¤ºä¾‹

```vue
<div v-if="totalPages > 1" class="pagination">
  <button
    @click="handlePageChange(currentPage - 1)"
    :disabled="currentPage <= 1"
    class="pagination-button"
  >
    <ChevronLeftIcon class="icon-sm" />
  </button>
  <span class="pagination-info">
    ç¬¬ {{ currentPage }} / {{ totalPages }} é¡µï¼Œå…± {{ totalElements }} æ¡
  </span>
  <button
    @click="handlePageChange(currentPage + 1)"
    :disabled="currentPage >= totalPages"
    class="pagination-button"
  >
    <ChevronRightIcon class="icon-sm" />
  </button>
</div>
```

### 2.2 å·¥å…·åˆ—è¡¨é¡µé¢

ä½ç½®ï¼š`front/piteAgents-admin/src/views/tool/List.vue`

å®ç°æ–¹å¼ä¸ Agent åˆ—è¡¨ç›¸åŒï¼Œå‚è€ƒä¸Šè¿°ä»£ç ç»“æ„ã€‚

### 2.3 API è°ƒç”¨ç¤ºä¾‹

#### API è¯·æ±‚å‚æ•°

```javascript
// åŸºç¡€åˆ†é¡µ
getAgentList({ page: 1, size: 20 })

// å¸¦ç­›é€‰æ¡ä»¶
getAgentList({ 
  category: 'ç¼–ç¨‹', 
  status: 'ACTIVE',
  page: 2, 
  size: 15 
})

// å¸¦æ’åº
getAgentList({ 
  page: 1, 
  size: 20,
  sortField: 'updatedAt',
  sortDirection: 'DESC'
})
```

#### å“åº”æ•°æ®å¤„ç†

```javascript
const response = await getAgentList(params)
const pageData = response.data

// æå–åˆ†é¡µæ•°æ®
const records = pageData.records      // æ•°æ®åˆ—è¡¨
const total = pageData.total          // æ€»è®°å½•æ•°
const currentPage = pageData.current  // å½“å‰é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
const totalPages = pageData.pages     // æ€»é¡µæ•°
const pageSize = pageData.size        // æ¯é¡µå¤§å°
```

---

## ä¸‰ã€åˆ†é¡µä½¿ç”¨è§„èŒƒ

### 3.1 é¡µç è§„èŒƒ

âš ï¸ **é‡è¦æé†’**ï¼š

- **åç«¯ï¼ˆMyBatis-Plusï¼‰**: é¡µç ä» **1** å¼€å§‹
- **å‰ç«¯**: é¡µç ä¹Ÿä» **1** å¼€å§‹
- ä¸ä¹‹å‰çš„ Spring Data åˆ†é¡µï¼ˆä» 0 å¼€å§‹ï¼‰ä¸åŒ

### 3.2 å‚æ•°ä¼ é€’è§„èŒƒ

#### Controller å±‚

```java
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰å‚æ•°éƒ½è®¾ç½®ä¸ºå¯é€‰
@GetMapping
public ApiResponse<IPage<AgentDTO>> listAgents(
        @RequestParam(required = false) String keyword,
        @RequestParam(required = false) Integer page,
        @RequestParam(required = false) Integer size,
        @RequestParam(required = false) String sortField,
        @RequestParam(required = false) String sortDirection) {
    // ...
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨é»˜è®¤å€¼ä¼šå¯¼è‡´å‰ç«¯æ— æ³•çœç•¥å‚æ•°
@GetMapping
public ApiResponse<IPage<AgentDTO>> listAgents(
        @RequestParam(defaultValue = "1") int page,  // ä¸æ¨è
        @RequestParam(defaultValue = "20") int size) { // ä¸æ¨è
    // ...
}
```

#### Service å±‚

```java
// æ¥å£å®šä¹‰
IPage<AgentDTO> listAgents(String category, String status, 
                           String keyword, IPage<AgentDTO> page);

// å®ç°è¦ç‚¹
public IPage<AgentDTO> listAgents(..., IPage<AgentDTO> page) {
    // 1. åˆ›å»º MyBatis-Plus åˆ†é¡µå¯¹è±¡
    Page<AgentPO> mpPage = new Page<>(page.getCurrent(), page.getSize());
    
    // 2. å¤åˆ¶æ’åºä¿¡æ¯
    if (page.orders() != null && !page.orders().isEmpty()) {
        mpPage.addOrder(page.orders());
    }
    
    // 3. æ‰§è¡ŒæŸ¥è¯¢
    IPage<AgentPO> result = mapper.selectPage(mpPage, queryWrapper);
    
    // 4. è½¬æ¢ä¸º DTO å¹¶è¿”å›
    Page<AgentDTO> resultPage = new Page<>(result.getCurrent(), 
                                           result.getSize(), 
                                           result.getTotal());
    resultPage.setRecords(result.getRecords().stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList()));
    
    return resultPage;
}
```

### 3.3 å®‰å…¨è§„èŒƒ

#### æ’åºå­—æ®µå®‰å…¨

åªå…è®¸ä½¿ç”¨ç™½åå•ä¸­çš„å­—æ®µè¿›è¡Œæ’åºï¼š

```java
// âœ… å®‰å…¨çš„æ’åºå­—æ®µ
sortField=createdAt
sortField=updatedAt
sortField=name
sortField=status

// âŒ ä¸å®‰å…¨çš„æ’åºå­—æ®µï¼ˆä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
sortField=password
sortField=secretKey
sortField=drop table users
```

#### é¡µé¢å¤§å°é™åˆ¶

```java
// âœ… åˆç†çš„é¡µé¢å¤§å°
size=10
size=20
size=100

// âš ï¸ è¶…è¿‡æœ€å¤§å€¼ä¼šè¢«é™åˆ¶
size=10000  // ä¼šè¢«é™åˆ¶ä¸º max-page-size (1000)

// âœ… æœªä¼ å…¥æ—¶ä½¿ç”¨é»˜è®¤å€¼
// ç¼ºçœ size å‚æ•° â†’ ä½¿ç”¨ default-page-size (20)
```

---

## å››ã€æœ€ä½³å®è·µ

### 4.1 Controller å¼€å‘è§„èŒƒ

1. **æ³¨å…¥åˆ†é¡µå·¥å…·ç±»**ï¼š
   ```java
   private final PaginationUtils paginationUtils;
   ```

2. **ä½¿ç”¨å·¥å…·ç±»åˆ›å»ºåˆ†é¡µå¯¹è±¡**ï¼š
   ```java
   IPage<DTO> pageParam = paginationUtils.createPage(page, size, sortField, sortDirection);
   ```

3. **è°ƒç”¨ Service å±‚æ–¹æ³•**ï¼š
   ```java
   IPage<DTO> result = service.listItems(filters, pageParam);
   ```

4. **è®°å½•åˆ†é¡µæ—¥å¿—ï¼ˆå¯é€‰ï¼‰**ï¼š
   ```java
   paginationUtils.logPaginationInfo(result, "æ“ä½œæè¿°");
   ```

5. **è¿”å›ç»Ÿä¸€å“åº”**ï¼š
   ```java
   return ApiResponse.success(result);
   ```

### 4.2 Service å¼€å‘è§„èŒƒ

1. **æ¥å£æ–¹æ³•ç­¾å**ï¼š
   ```java
   IPage<DTO> listItems(FilterParams..., IPage<DTO> page);
   ```

2. **åˆ›å»º MyBatis-Plus åˆ†é¡µå¯¹è±¡**ï¼š
   ```java
   Page<PO> mpPage = new Page<>(page.getCurrent(), page.getSize());
   ```

3. **å¤åˆ¶æ’åºä¿¡æ¯**ï¼š
   ```java
   if (page.orders() != null && !page.orders().isEmpty()) {
       mpPage.addOrder(page.orders());
   }
   ```

4. **æ‰§è¡ŒæŸ¥è¯¢**ï¼š
   ```java
   IPage<PO> result = mapper.selectPage(mpPage, queryWrapper);
   ```

5. **è½¬æ¢ä¸º DTO**ï¼š
   ```java
   Page<DTO> resultPage = new Page<>(result.getCurrent(), result.getSize(), result.getTotal());
   resultPage.setRecords(result.getRecords().stream()
           .map(this::convertToDTO)
           .collect(Collectors.toList()));
   return resultPage;
   ```

### 4.3 å‰ç«¯å¼€å‘è§„èŒƒ

1. **çŠ¶æ€åˆå§‹åŒ–**ï¼š
   ```javascript
   const currentPage = ref(1)  // ä»1å¼€å§‹
   const searchParams = reactive({
     page: 1,     // ä»1å¼€å§‹
     size: 20,
     sortField: '',
     sortDirection: ''
   })
   ```

2. **å“åº”æ•°æ®å¤„ç†**ï¼š
   ```javascript
   const pageData = response.data
   items.value = pageData.records || []
   totalPages.value = pageData.pages || 0
   totalElements.value = pageData.total || 0
   currentPage.value = pageData.current || 1
   ```

3. **ç¿»é¡µé€»è¾‘**ï¼š
   ```javascript
   const handlePageChange = (page) => {
     searchParams.page = page
     loadData()
   }
   ```

4. **æœç´¢é‡ç½®**ï¼š
   ```javascript
   const handleSearch = () => {
     searchParams.page = 1  // æœç´¢æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ
     loadData()
   }
   ```

5. **åˆ†é¡µå™¨æ¨¡æ¿**ï¼š
   ```vue
   <button :disabled="currentPage <= 1" @click="handlePageChange(currentPage - 1)">
     ä¸Šä¸€é¡µ
   </button>
   <span>ç¬¬ {{ currentPage }} / {{ totalPages }} é¡µï¼Œå…± {{ totalElements }} æ¡</span>
   <button :disabled="currentPage >= totalPages" @click="handlePageChange(currentPage + 1)">
     ä¸‹ä¸€é¡µ
   </button>
   ```

---

## äº”ã€å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé¡µç ä» 1 å¼€å§‹ï¼Ÿ

**A**: MyBatis-Plus çš„åˆ†é¡µæ’ä»¶è®¾è®¡ä¸ºä» 1 å¼€å§‹ï¼Œè¿™ä¹Ÿç¬¦åˆç”¨æˆ·çš„ç›´è§‰è®¤çŸ¥ã€‚ä¹‹å‰ä½¿ç”¨ Spring Data åˆ†é¡µæ—¶ä» 0 å¼€å§‹ã€‚

### Q2: å¦‚ä½•ä¿®æ”¹é»˜è®¤åˆ†é¡µå¤§å°ï¼Ÿ

**A**: åœ¨ `application.yml` ä¸­ä¿®æ”¹ `pite-agents.pagination.default-page-size` é…ç½®å³å¯ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

### Q3: å¦‚ä½•æ·»åŠ æ–°çš„æ’åºå­—æ®µï¼Ÿ

**A**: åœ¨ `PaginationUtils` çš„ `ALLOWED_SORT_FIELDS` ç™½åå•ä¸­æ·»åŠ æ–°å­—æ®µï¼š

```java
private static final Set<String> ALLOWED_SORT_FIELDS = new HashSet<>(Arrays.asList(
    "id", "createdAt", "updatedAt", "name", "title", "status",
    "yourNewField"  // æ·»åŠ æ–°å­—æ®µ
));
```

### Q4: ä¸ºä»€ä¹ˆéœ€è¦æ’åºå­—æ®µç™½åå•ï¼Ÿ

**A**: é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚å¦‚æœç›´æ¥å°†ç”¨æˆ·è¾“å…¥çš„æ’åºå­—æ®µæ‹¼æ¥åˆ° SQL ä¸­ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ„é€ ç‰¹æ®Šå­—ç¬¦ä¸²æ‰§è¡Œæ¶æ„ SQLã€‚

### Q5: å‰ç«¯å¦‚ä½•å¤„ç† Spring Data åˆ° MyBatis-Plus çš„è¿ç§»ï¼Ÿ

**A**: ä¸»è¦ä¿®æ”¹å“åº”æ•°æ®çš„å­—æ®µæ˜ å°„ï¼š

| Spring Data | MyBatis-Plus | è¯´æ˜ |
|------------|--------------|------|
| `content` | `records` | æ•°æ®åˆ—è¡¨ |
| `totalElements` | `total` | æ€»è®°å½•æ•° |
| `totalPages` | `pages` | æ€»é¡µæ•° |
| `number` | `current` | å½“å‰é¡µç  |
| ä» 0 å¼€å§‹ | ä» 1 å¼€å§‹ | é¡µç èµ·å§‹å€¼ |

### Q6: å¦‚ä½•å¤„ç†å¤§æ•°æ®é‡åˆ†é¡µï¼Ÿ

**A**: 
1. é…ç½®åˆç†çš„ `max-page-size` é™åˆ¶ï¼ˆé»˜è®¤ 1000ï¼‰
2. å‰ç«¯é¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
3. ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–çš„æ’åºå­—æ®µï¼ˆå¦‚ `createdAt`ã€`id`ï¼‰
4. è€ƒè™‘ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæˆ–æµå¼æŸ¥è¯¢ï¼ˆå¦‚æœéœ€è¦ï¼‰

### Q7: åˆ†é¡µæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Ÿ

**A**:
1. **æ·»åŠ æ•°æ®åº“ç´¢å¼•**ï¼šä¸ºå¸¸ç”¨çš„æ’åºå­—æ®µæ·»åŠ ç´¢å¼•
   ```sql
   CREATE INDEX idx_created_at ON agent(created_at);
   CREATE INDEX idx_updated_at ON agent(updated_at);
   ```

2. **é¿å…æ·±åº¦åˆ†é¡µ**ï¼šé¡µç è¶Šå¤§ï¼ŒæŸ¥è¯¢è¶Šæ…¢ï¼Œå»ºè®®ï¼š
   - é™åˆ¶æœ€å¤§é¡µç ï¼ˆå¦‚ 100 é¡µï¼‰
   - ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µä»£æ›¿ offset åˆ†é¡µ

3. **åˆç†è®¾ç½®é¡µé¢å¤§å°**ï¼š
   - åˆ—è¡¨é¡µï¼š10-20 æ¡
   - ä¸‹æ‹‰é€‰æ‹©ï¼š50-100 æ¡
   - é¿å…è¶…è¿‡ 1000 æ¡

---

## å…­ã€ä»£ç æ¸…å•

### 6.1 åç«¯æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|---------|------|
| `config/PaginationProperties.java` | åˆ†é¡µé…ç½®å±æ€§ç±» |
| `common/utils/PaginationUtils.java` | åˆ†é¡µå·¥å…·ç±» |
| `config/MyBatisPlusConfig.java` | MyBatis-Plus é…ç½®ï¼ˆåŒ…å«åˆ†é¡µæ’ä»¶ï¼‰ |
| `controller/AgentController.java` | Agent æ§åˆ¶å™¨ç¤ºä¾‹ |
| `service/IAgentService.java` | Agent æœåŠ¡æ¥å£ |
| `service/impl/AgentServiceImpl.java` | Agent æœåŠ¡å®ç° |

### 6.2 å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|---------|------|
| `views/agent/List.vue` | Agent åˆ—è¡¨é¡µï¼ˆåˆ†é¡µç¤ºä¾‹ï¼‰ |
| `views/tool/List.vue` | å·¥å…·åˆ—è¡¨é¡µï¼ˆåˆ†é¡µç¤ºä¾‹ï¼‰ |
| `api/agent.js` | Agent API å°è£… |
| `api/tool.js` | å·¥å…· API å°è£… |

### 6.3 é…ç½®æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|---------|------|
| `resources/application.yml` | å…¨å±€é…ç½®ï¼ˆåŒ…å«åˆ†é¡µé…ç½®ï¼‰ |

---

## ä¸ƒã€å¿«é€Ÿå¼€å§‹

### 7.1 æ·»åŠ æ–°çš„åˆ†é¡µæŸ¥è¯¢æ¥å£

#### æ­¥éª¤ 1: Controller å±‚

```java
@GetMapping
public ApiResponse<IPage<YourDTO>> listItems(
        @RequestParam(required = false) Integer page,
        @RequestParam(required = false) Integer size,
        @RequestParam(required = false) String sortField,
        @RequestParam(required = false) String sortDirection) {
    
    IPage<YourDTO> pageParam = paginationUtils.createPage(page, size, sortField, sortDirection);
    IPage<YourDTO> result = yourService.listItems(pageParam);
    paginationUtils.logPaginationInfo(result, "æŸ¥è¯¢XXXåˆ—è¡¨");
    return ApiResponse.success(result);
}
```

#### æ­¥éª¤ 2: Service æ¥å£

```java
IPage<YourDTO> listItems(IPage<YourDTO> page);
```

#### æ­¥éª¤ 3: Service å®ç°

```java
@Override
public IPage<YourDTO> listItems(IPage<YourDTO> page) {
    // åˆ›å»ºåˆ†é¡µå¯¹è±¡
    Page<YourPO> mpPage = new Page<>(page.getCurrent(), page.getSize());
    
    // å¤åˆ¶æ’åº
    if (page.orders() != null && !page.orders().isEmpty()) {
        mpPage.addOrder(page.orders());
    }
    
    // æ‰§è¡ŒæŸ¥è¯¢
    IPage<YourPO> result = yourMapper.selectPage(mpPage, queryWrapper);
    
    // è½¬æ¢ä¸º DTO
    Page<YourDTO> resultPage = new Page<>(result.getCurrent(), result.getSize(), result.getTotal());
    resultPage.setRecords(result.getRecords().stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList()));
    
    return resultPage;
}
```

#### æ­¥éª¤ 4: å‰ç«¯é¡µé¢

```javascript
// çŠ¶æ€
const page = ref(1)
const size = ref(20)
const items = ref([])
const totalPages = ref(0)

// åŠ è½½æ•°æ®
const loadItems = async () => {
  const response = await getItemList({ page: page.value, size: size.value })
  const pageData = response.data
  items.value = pageData.records
  totalPages.value = pageData.pages
  page.value = pageData.current
}

// ç¿»é¡µ
const changePage = (newPage) => {
  page.value = newPage
  loadItems()
}
```

### 7.2 å¦‚æœéœ€è¦è‡ªå®šä¹‰æ’åº

#### åç«¯

åœ¨ Controller å±‚ä¼ å…¥ç‰¹å®šçš„æ’åºå­—æ®µï¼š

```java
// ä¸ºç‰¹å®šæŸ¥è¯¢æŒ‡å®šé»˜è®¤æ’åº
String defaultSortField = sortField != null ? sortField : "updatedAt";
IPage<DTO> pageParam = paginationUtils.createPage(page, size, defaultSortField, sortDirection);
```

#### å‰ç«¯

ä¼ å…¥æ’åºå‚æ•°ï¼š

```javascript
await getItemList({ 
  page: 1, 
  size: 20,
  sortField: 'name',      // æŒ‰åç§°æ’åº
  sortDirection: 'ASC'    // å‡åº
})
```

---

## å…«ã€è¿ç§»æŒ‡å—

### 8.1 ä» Spring Data åˆ†é¡µè¿ç§»åˆ° MyBatis-Plus åˆ†é¡µ

#### åç«¯è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] ç§»é™¤ `org.springframework.data.domain.Page` å¯¼å…¥
- [ ] æ·»åŠ  `com.baomidou.mybatisplus.core.metadata.IPage` å¯¼å…¥
- [ ] ä¿®æ”¹æ–¹æ³•ç­¾åä½¿ç”¨ `IPage<T>` ä»£æ›¿ `Page<T>`
- [ ] ä½¿ç”¨ `page.getCurrent()` ä»£æ›¿ `pageable.getPageNumber() + 1`
- [ ] ä½¿ç”¨ `page.getSize()` ä»£æ›¿ `pageable.getPageSize()`
- [ ] å“åº”å­—æ®µä» `content` æ”¹ä¸º `records`
- [ ] ç§»é™¤ `PageImpl` çš„ä½¿ç”¨

#### å‰ç«¯è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] é¡µç åˆå§‹å€¼ä» `0` æ”¹ä¸º `1`
- [ ] å“åº”å­—æ®µ `content` æ”¹ä¸º `records`
- [ ] å“åº”å­—æ®µ `totalElements` æ”¹ä¸º `total`
- [ ] å“åº”å­—æ®µ `totalPages` æ”¹ä¸º `pages`
- [ ] å“åº”å­—æ®µ `number` æ”¹ä¸º `current`
- [ ] åˆ†é¡µå™¨åˆ¤æ–­ä» `currentPage === 0` æ”¹ä¸º `currentPage <= 1`
- [ ] åˆ†é¡µå™¨åˆ¤æ–­ä» `currentPage >= totalPages - 1` æ”¹ä¸º `currentPage >= totalPages`
- [ ] é¡µç æ˜¾ç¤ºä» `currentPage + 1` æ”¹ä¸º `currentPage`

---

## ä¹ã€æµ‹è¯•å»ºè®®

### 9.1 åç«¯æµ‹è¯•

```java
// æµ‹è¯•é»˜è®¤åˆ†é¡µ
GET /api/agents
// é¢„æœŸï¼šè¿”å›ç¬¬1é¡µï¼Œæ¯é¡µ20æ¡ï¼ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼‰

// æµ‹è¯•æŒ‡å®šåˆ†é¡µ
GET /api/agents?page=2&size=10
// é¢„æœŸï¼šè¿”å›ç¬¬2é¡µï¼Œæ¯é¡µ10æ¡

// æµ‹è¯•æ’åº
GET /api/agents?sortField=name&sortDirection=ASC
// é¢„æœŸï¼šæŒ‰åç§°å‡åºæ’åˆ—

// æµ‹è¯•å®‰å…¨é™åˆ¶
GET /api/agents?size=10000
// é¢„æœŸï¼šé¡µé¢å¤§å°è¢«é™åˆ¶ä¸º1000ï¼ˆmax-page-sizeï¼‰

// æµ‹è¯•éæ³•æ’åºå­—æ®µ
GET /api/agents?sortField=invalidField
// é¢„æœŸï¼šè¿”å›400é”™è¯¯ï¼Œæç¤ºä¸æ”¯æŒçš„æ’åºå­—æ®µ
```

### 9.2 å‰ç«¯æµ‹è¯•

1. **æµ‹è¯•ç¿»é¡µåŠŸèƒ½**ï¼š
   - ç‚¹å‡»"ä¸Šä¸€é¡µ"/"ä¸‹ä¸€é¡µ"æŒ‰é’®
   - éªŒè¯é¡µç æ­£ç¡®é€’å¢/é€’å‡
   - éªŒè¯ç¬¬ä¸€é¡µæ—¶"ä¸Šä¸€é¡µ"æŒ‰é’®ç¦ç”¨
   - éªŒè¯æœ€åä¸€é¡µæ—¶"ä¸‹ä¸€é¡µ"æŒ‰é’®ç¦ç”¨

2. **æµ‹è¯•æœç´¢åŠŸèƒ½**ï¼š
   - è¾“å…¥æœç´¢å…³é”®è¯
   - éªŒè¯é¡µç é‡ç½®ä¸º 1
   - éªŒè¯æœç´¢ç»“æœæ­£ç¡®æ˜¾ç¤º

3. **æµ‹è¯•ç­›é€‰åŠŸèƒ½**ï¼š
   - åˆ‡æ¢ç­›é€‰æ¡ä»¶
   - éªŒè¯é¡µç é‡ç½®ä¸º 1
   - éªŒè¯ç­›é€‰ç»“æœæ­£ç¡®

4. **æµ‹è¯•åˆ†é¡µä¿¡æ¯æ˜¾ç¤º**ï¼š
   - éªŒè¯ "ç¬¬ X / Y é¡µï¼Œå…± Z æ¡" æ˜¾ç¤ºæ­£ç¡®
   - éªŒè¯æ€»è®°å½•æ•°å‡†ç¡®

---

## åã€æ€»ç»“

æœ¬é¡¹ç›®çš„ç»Ÿä¸€åˆ†é¡µæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### âœ… ä¼˜åŠ¿

1. **ç»Ÿä¸€æ€§**: æ‰€æœ‰åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ç›¸åŒçš„å·¥å…·ç±»å’Œé…ç½®
2. **å¯é…ç½®**: é€šè¿‡ YAML é…ç½®åˆ†é¡µå‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
3. **å®‰å…¨æ€§**: æ’åºå­—æ®µç™½åå•ã€é¡µé¢å¤§å°é™åˆ¶ã€SQL æ³¨å…¥é˜²æŠ¤
4. **æ˜“ç»´æŠ¤**: é›†ä¸­ç®¡ç†åˆ†é¡µé€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç 
5. **è§„èŒƒæ€§**: ç»Ÿä¸€çš„å‚æ•°å‘½åå’Œè¿”å›æ ¼å¼
6. **çµæ´»æ€§**: æ”¯æŒåŠ¨æ€æ’åºå­—æ®µå’Œæ–¹å‘

### ğŸ¯ ä½¿ç”¨è¦ç‚¹

1. é¡µç ä» **1** å¼€å§‹ï¼ˆMyBatis-Plus è§„èŒƒï¼‰
2. æ‰€æœ‰åˆ†é¡µå‚æ•°éƒ½æ˜¯**å¯é€‰**çš„ï¼Œæœªä¼ å…¥æ—¶ä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼
3. æ’åºå­—æ®µå¿…é¡»åœ¨**ç™½åå•**ä¸­ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸
4. é¡µé¢å¤§å°ä¼šè¢«é™åˆ¶åœ¨ `max-page-size` ä»¥å†…
5. å‰ç«¯å“åº”æ•°æ®ä½¿ç”¨ `records`ã€`total`ã€`current`ã€`pages` å­—æ®µ

### ğŸ“ ç»´æŠ¤å»ºè®®

1. æ·»åŠ æ–°çš„æ’åºå­—æ®µæ—¶ï¼Œè®°å¾—æ›´æ–°ç™½åå•
2. æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ YAML é…ç½®çš„é»˜è®¤å€¼
3. å®šæœŸæ£€æŸ¥åˆ†é¡µæŸ¥è¯¢çš„æ€§èƒ½ï¼Œå¿…è¦æ—¶æ·»åŠ æ•°æ®åº“ç´¢å¼•
4. ä¿æŒå‰åç«¯åˆ†é¡µé€»è¾‘çš„ä¸€è‡´æ€§

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-10-25  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç»´æŠ¤äººå‘˜**: piteAgents Team

